{"version":3,"sources":["webpack:///webpack/bootstrap 171ed5a5835904636afc","webpack:///./src/worker.js","webpack:///./src/matchalg.js","webpack:///./src/randomset.js"],"names":["bestOf","matching","teams","consts","n","bestMatching","bestScore","score","m","i","baseMatching","baseScore","j","attemptMatching","shuffleMatch","attemptScore","onmessage","event","data","type","console","log","iterations","bestM","bestS","postMessage","calcCrow","p1","p2","toRad","Value","Math","PI","_lat1","lon1","_lat2","lon2","R","dLat","dLon","lat1","lat2","a","sin","cos","c","atan2","sqrt","d","cursor3d","nx","ny","nz","x","y","z","val","idx","undefined","initialMatch","origTeams","numDishes","nteams","length","ndishes","ngroups","team","lat","lng","name1","name2","push","id","availCooks","randomSet","fromRange","availGuests","cook","pop","del","k","guest","match","_match","tsProb","ssProb","slice","isNaN","rolls","chance","roll","random","team1","team2","team1pos","team2pos","dish","group","seat","group1","seat1","group2","seat2","_","summarizeConstraints","constraints","dishes","dishcs","factorDistance","factorDissimilar","factorOnce","value","penalty","name","JSON","stringify","isSummary","distance","deviation","multiple","debug","routes","meets","dishPenalties","host","totalDist","dists","totalTeam","prev","curr","dist","avgDist","stdDev","diff","onceViolations","dev","once","set","has","add","get","Object","keys","pick","augment","obj","fromArray","arr","min","max","fromEmpty"],"mappings":"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","file":"171ed5a5835904636afc.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 171ed5a5835904636afc","import {initialMatch, shuffleMatch, summarizeConstraints, score, cursor3d} from './matchalg';\n\n/** Messaging interface\n *\n * Worker receives messages\n * { type: 'reset', teams: teams, consts: consts }\n * { type: 'improve', matching: matching, iterations: num }\n *\n * Worker sends messages\n * { type: 'done', matching: matching, score: score }\n */\n\nfunction bestOf(matching, teams, consts, n) {\n  if (matching === null) throw \"matching === null\";\n  if (teams === null) throw \"teams === null\";\n  if (consts === null) throw \"teams === null\";\n\n  let bestMatching = matching;\n  let bestScore = score(matching, teams, consts);\n\n  let m = 10;\n  // do m attempts on improving the matching, then select best of those\n  for (let i = 0; i < ((n/m)<<0); ++i) {\n    let baseMatching = bestMatching;\n    let baseScore = bestScore;\n    for (let j = 0; j < m; ++j) {\n      let attemptMatching = shuffleMatch(baseMatching, [2, 0.125], [10, 0.2]);\n      let attemptScore = score(attemptMatching, teams, consts);\n      if (attemptScore < baseScore) {\n        bestMatching = attemptMatching;\n        bestScore = attemptScore;\n      }\n    }\n  }\n  \n  return [bestMatching, bestScore];\n}\n\nlet teams = null;\nlet consts = null;\n\nonmessage = function(event) {\n  let data = event.data;\n  switch (data.type) {\n    case 'reset':\n      teams = data.teams;\n      consts = data.consts;\n      console.log('worker initialized');\n      break;\n    case 'improve':\n      let matching = data.matching;\n      let n = data.iterations;\n      let [bestM, bestS] = bestOf(matching, teams, consts, n);\n      postMessage({\n        type: 'done',\n        matching: bestM,\n        score: bestS\n      });\n      break;\n    default:\n      throw `unsupported message '${data.type}'`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/worker.js","import randomSet from './randomset';\n\n/* Distance by the way the crow flies. In kilometers.\n */\nfunction calcCrow(p1, p2) {\n  \"use strict\";\n  function toRad(Value) {\n    return Value * Math.PI / 180;\n  }\n  let [_lat1, lon1] = p1;\n  let [_lat2, lon2] = p2;\n  var R = 6371; // km\n  var dLat = toRad(_lat2-_lat1);\n  var dLon = toRad(lon2-lon1);\n  var lat1 = toRad(_lat1);\n  var lat2 = toRad(_lat2);\n\n  var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n    Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n  var d = R * c;\n  return d;\n}\n\n/* Creates a cursor function for 3d access to a linearized array.\n * fn(x, y, z)      -> read element at [x, y, z]\n * fn(x, y, z, val) -> set element at [x, y, z] to val\n */\nfunction cursor3d(data, nx, ny, nz) {\n  return function(x, y, z, val) {\n    let idx = 0;\n    idx += x;\n    idx += y * nx;\n    idx += z * nx * ny;\n    if (val !== undefined) {\n      data[idx] = val;\n    } else {\n      return data[idx]\n    }\n  }\n}\n\n\n/* Creates an initial random match from the team list and the nubmer of dishes.\n * Returns a three-dimensional array of:\n * [ for each dish : (numDishes)\n *   [ for each group : (numTeams / numDishes)\n *     [ cook, guest, guest, ... : (numDishes)]]]\n */\nfunction initialMatch(origTeams, numDishes) {\n  let nteams = origTeams.length;\n  let ndishes = numDishes;\n  let ngroups = nteams / ndishes;\n\n  let nx = ndishes;\n  let ny = ngroups;\n  let nz = ndishes;\n\n  if (nteams % ndishes != 0) {\n    return [`number of teams (${nteams}) not divisable by number of dishes (${ndishes})!`, null];\n  }\n\n  // (partial) local deep copy of teams for safety\n  let teams = [];\n  for (let i = 0; i < nteams; ++i) {\n    let team = origTeams[i];\n    if (typeof team.lat !== \"number\" || typeof team.lng !== \"number\") {\n      return [`Team ${team.name1}, ${team.name2} is missing coordinates`, null];\n    }\n    teams.push({id: i, lat: team.lat, lng: team.lng});\n  }\n\n  let availCooks = randomSet.fromRange(0, nteams);\n\n\n  let data = []\n  for (let i = 0; i < nx*ny*nz; ++i) {\n    data[i] = -1;\n  }\n  let val = cursor3d(data, nx, ny, nz);\n\n  // for each dish, first select cooks, then guests\n  for (let i = 0; i < ndishes; ++i) {\n    // list of available Guests\n    let availGuests = randomSet.fromRange(0, nteams);\n\n    // for each group select a cook\n    for (let j = 0; j < ngroups; ++j) {\n      // pick and remove cook\n      let cook = availCooks.pop();\n      // remove cook from available guests\n      availGuests.del(cook);\n      // assign cook\n      val(i, j, 0, cook << 0);\n    }\n\n    for (let j = 0; j < ngroups; ++j) {\n      // ndishes - 1 guests\n      for (let k = 1; k < ndishes; ++k) {\n        // pick and remove guest\n        let guest = availGuests.pop();\n        // assign guest\n        val(i, j, k, guest << 0);\n      }\n    }\n  }\n\n  let match = {\n    nx: ndishes,\n    ny: ngroups,\n    nz: ndishes,\n    data: data,\n  }\n  return [null, match];\n}\n\n/* Takes an existing valid matches and returns a copy with a statistic number\n * of switches applied. The resulting match is still valid.\n * It might be better or worse than the original (pure random).\n * The following two switch operations exist:\n * teamSwitch: take two teams and switch every of their occurences,\n *   this allows a team to change the meal they're cooking\n * seatSwitch: withing a dish, take two random teams and switch places.\n *   A guest is switched with another guest and a cook is switched with\n *   another cook. Switching cook and guest would result in an invalid match.\n * While seatSwitching is cheap, it restricts each team to its initial role\n * for each dish (cook/guest) which locks a match into local optima.\n * teamSwitching is supposed to fix this.\n * Rule of thumb: do teamSwitches sparingly and sweatSwitches more liberally.\n * The probabilities are based on dice rolls with [2, 0.1] meaning two dice\n * rolls, each with a probability of 10%.\n */\nfunction shuffleMatch(_match, tsProb, ssProb) {\n  // make copy and keep the same name, we don't want to mix up names\n  let match = {\n    nx: _match.nx,\n    ny: _match.ny,\n    nz: _match.nz,\n    data: _match.data.slice(),\n  }\n  let val = cursor3d(match.data, match.nx, match.ny, match.nz);\n\n  let ndishes = match.nx;\n  let nteams = match.nx * match.ny;\n  let ngroups = match.ny;\n\n  // check for usage errors, use exception because it's faulty logic\n  if (isNaN(tsProb[0]) || isNaN(tsProb[1]) || isNaN(ssProb[0]) || isNaN(ssProb[1])) {\n    throw 'bad probabilities';\n  }\n\n  let [rolls, chance] = tsProb;\n\n  for (let roll = 0; roll < rolls; ++roll) {\n    // don't do anything if dice roll is unsuccessful\n    if (Math.random() > chance) continue;\n    let team1 = (nteams * Math.random()) << 0; // << 0 forces integer by rounding down\n    let team2 = (nteams * Math.random()) << 0;\n    while (team2 == team1) {\n      team2 = (nteams * Math.random()) << 0;\n    }\n\n    let team1pos = [null, null, null];\n    let team2pos = [null, null, null];\n\n    // find teams in matching\n    for (let dish = 0; dish < ndishes; ++dish) {\n      for (let group = 0; group < ngroups; ++group) {\n        for (let seat = 0; seat < ndishes; ++seat) {\n          if (val(dish, group, seat) << 0 == team1) {\n            team1pos[dish] = [group, seat]\n          }\n          if (val(dish, group, seat) << 0 === team2) {\n            team2pos[dish] = [group, seat]\n          }\n        }\n      }\n    }\n\n    // swap teams\n    for (let dish = 0; dish < ndishes; ++dish) {\n      let [group1, seat1] = team1pos[dish];\n      let [group2, seat2] = team2pos[dish];\n      val(dish, group1, seat1, team2 << 0);\n      val(dish, group2, seat2, team1 << 0);\n    }\n  }\n\n  [rolls, chance] = ssProb;\n  for (let _ = 0; _ < rolls; ++_) {\n    // don't do anything if dice roll is unsuccessful\n    if (Math.random() > chance) continue;\n    // select dish within which to switch\n    let dish = ndishes * Math.random() << 0;\n    // select seat to switch\n    let seat = ndishes * Math.random() << 0;\n    // select groups which to switch seats\n    let group1 = ngroups * Math.random() << 0;\n    let group2 = ngroups * Math.random() << 0;\n    while (group2 == group1) {\n      group2 = ngroups * Math.random() << 0;\n    }\n    // get current assignments\n    let team1 = val(dish, group1, seat) << 0;\n    let team2 = val(dish, group2, seat) << 0;\n    // do the switch\n    val(dish, group1, seat, team2 << 0);\n    val(dish, group2, seat, team1 << 0);\n  }\n\n  return match;\n}\n\n/* Create an easier digestable summary of the constraints.\n * param dishes    [\"starter\", ...]\n *\n * Constraints:\n * - {type: \"misc\", value: \"once\", [penalty: 10000]}\n *   penalty for each time two teams meet twice\n * - {type: \"misc\", value: \"short\", [penalty: 1]}\n *   penalty for each kilometer walked\n * - {type: \"misc\", value: \"similar\", [penalty: 1]}\n *   penalty for each kilometer of standard deviation of all paths\n * - {type: \"dish\", team: number, dish: number, [penalty: 1000]}\n *   penalty if a team does not cook a dish they want\n * - {type: \"not-dish\", team: number, dish: number, [penalty: 1000]}\n *   penalty if a team does cook a dish they  do not want\n * \n * Returns: {\n *  dishes: { <teamId>: { <dish>:<penalty> }, ...},\n *  distance: <penalty>,\n *  deviation: <penalty>,\n *  multiple: <penalty>,\n * }\n */\nfunction summarizeConstraints(constraints, dishes) {\n  let dishcs = {}; // for each team with a dish constraint:\n    // {number: penalty, number: penalty, ...}\n    // e.g. \"want starter\"      -> {1: penalty, 2: penalty}\n    //      \"not want starter\"  -> {0: penalty}\n  let factorDistance = 0;\n  let factorDissimilar = 0;\n  let factorOnce = 0;\n  for (let i = 0; i < constraints.length; ++i) {\n    let c = constraints[i];\n    if (c.type == \"misc\" && c.value == \"once\") {\n      factorOnce += c.penalty !== undefined ? c.penalty : 10000;\n      continue;\n    }\n    if (c.type == \"misc\" && c.value == \"short\") {\n      factorDistance += c.penalty !== undefined ? c.penalty : 2;\n      continue;\n    }\n    if (c.type == \"misc\" && c.value == \"similar\") {\n      factorDissimilar += c.penalty !== undefined ? c.penalty : 2;\n      continue;\n    }\n    if (c.type == \"dish\" || c.type == \"not-dish\") {\n      if (dishcs[c.team] == undefined) {\n        dishcs[c.team] = {}\n      }\n      for (let i = 0; i < dishes.length; ++i) {\n        let name = dishes[i];\n        if ((c.type == \"dish\" && name != c.dish) || (c.type == \"not-dish\" && name == c.dish)) {\n          if (dishcs[c.team][i] === undefined) {\n            dishcs[c.team][i] = c.penalty !== undefined ? c.penalty : 1000;\n          } else {\n            dishcs[c.team][i] += c.penalty !== undefined ? c.penalty : 1000;\n          }\n        }\n      }\n      continue;\n    }\n    throw \"unknown Constraint: \" + JSON.stringify(constraints[i]);\n  }\n  return {\n    isSummary: true,\n    dishes: dishcs,\n    distance: factorDistance,\n    deviation: factorDissimilar,\n    multiple: factorOnce,\n  }\n}\n\n/* Assigns a score to a match based on a set of constraints.\n * The lower the score, the better the results.\n * The constraints must be preprocessed by summarizeConstraints.\n *\n * Returns: score\n */\nfunction score(match, teams, constraints, debug) {\n  if (!constraints.isSummary) throw \"scoreQuck expects constraints\";\n\n  // make copy and keep the same name, we don't want to mix up names\n  match = {\n    nx: match.nx,\n    ny: match.ny,\n    nz: match.nz,\n    data: match.data.slice(),\n  }\n  let val = cursor3d(match.data, match.nx, match.ny, match.nz);\n\n  let ndishes = match.nx;\n  let nteams = match.nx * match.ny;\n  let ngroups = match.ny;\n\n  // routes of each team\n  // shape: [ [loc, loc, loc...], [loc, loc, loc...] ]\n  let routes = []; \n  routes.length = nteams;\n  for (let i = 0; i < nteams; ++i) {\n    routes[i] = [];\n    routes[i].length = ndishes;\n  }\n\n  // meeting counts\n  // shape: { <id>: {<id>: <num>} }\n  let meets = {};\n\n  let dishcs = constraints.dishes;\n  let dishPenalties = 0;\n\n  /////////////////////////////////////////////////////////\n  // Collect data\n  for (let dish = 0; dish < ndishes; ++dish) {\n    for (let group = 0; group < ngroups; ++group) {\n      for (let seat = 0; seat < ndishes; ++seat) {\n        let host = val(dish, group, 0) << 0;\n        let team = val(dish, group, seat) << 0;\n\n        // add position to route\n        routes[team][dish] = [teams[host].lat, teams[host].lng]\n\n        // add all meetings\n        for (let seat2 = 0; seat2 < ndishes; ++seat2) {\n          if (seat == seat2) continue;\n\n          let team2 = val(dish, group, seat2);\n          if (meets[team] === undefined) meets[team] = {};\n\n          if (meets[team][team2] === undefined) {\n            meets[team][team2] = 1;\n          } else {\n            meets[team][team2] += 1;\n          }\n        }\n\n        // calculate dish penalty\n        if (seat == 0 && dishcs[team] !== undefined && dishcs[team][dish] !== undefined) {\n          dishPenalties += dishcs[team][dish];\n        }\n      }\n    }\n  }\n\n  let totalDist = 0;\n  let dists = [];\n  dists.length = nteams;\n\n  /////////////////////////////////////////////////////////\n  // calculate total distance\n  for (let team = 0; team < nteams; ++team) {\n    let totalTeam = 0;\n    for (let dish = 1; dish < ndishes; ++dish) {\n      let prev = routes[team][dish-1];\n      let curr = routes[team][dish];\n      if (curr == undefined || prev == undefined) {\n        console.log(`team: ${team}, dish: ${dish}`);\n        console.log(`routes of ${team}: `, routes[team]);\n        console.log(\"prev: \", prev, \"curr: \", curr);\n      }\n      let dist = calcCrow(prev, curr);\n      totalDist += dist;\n      totalTeam += dist;\n    }\n    dists[team] = totalTeam;\n  }\n\n  let avgDist = totalDist / nteams;\n  let stdDev = 0;\n\n  // calculate standard deviation\n  for (let team = 0; team < nteams; ++team) {\n    let diff = dists[team] - avgDist;\n    stdDev += diff * diff;\n  }\n  stdDev = Math.sqrt(stdDev / (nteams - 1));\n\n  /////////////////////////////////////////////////////////\n  // meetups violations\n  let onceViolations = 0;\n  for (let team1 in meets) {\n    for (let team2 in meets[team1]) {\n      if (meets[team1][team2] > 1) {\n        onceViolations += 1;\n      }\n    }\n  }\n\n  //console.log(`${totalDist} ${stdDev} ${dishPenalties} ${onceViolations}`)\n  if (debug !== undefined && debug !== null) {\n    debug.dist = totalDist;\n    debug.dev = stdDev;\n    debug.dish = dishPenalties;\n    debug.once = onceViolations;\n  }\n\n  return (totalDist * constraints.distance) +\n    (stdDev * constraints.deviation) +\n    (dishPenalties) +\n    (onceViolations * constraints.multiple);\n}\n\nexport {\n  initialMatch,\n  shuffleMatch,\n  summarizeConstraints,\n  score,\n  cursor3d,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/matchalg.js","/******************************************************************************\n * Random Set\n * Pretty much a regular set, but with random pick function\n */\n\nfunction del(set, val) {\n  if (set[val] === undefined) {\n    throw 'element not in set!';\n  }\n  delete set[val];\n}\n\nfunction has(set, val) {\n  return set[val] === true;\n}\n\nfunction add(set, val) {\n  if (set[val] === true) {\n    throw 'element already in set!';\n  }\n  set[val] = true;\n}\n\nfunction get(set) {\n  return Object.keys(set);\n}\n\nfunction pick(set) {\n  if (Object.keys(set).length == 0) {\n    throw 'trying to pick/pop from empty set';\n  }\n  let keys = Object.keys(set);\n  let val = keys[keys.length * Math.random() << 0];\n  return val;\n}\n\nfunction pop(set) {\n  let val = pick(set);\n  del(set, val);\n  return val;\n}\n\nfunction augment(obj) {\n  return {\n    has: (val) => { return has(obj, val); },\n      get: (val) => { return get(obj); },\n      add: (val) => { return add(obj, val); },\n      del: (val) => { return del(obj, val); },\n      pick: () => { return pick(obj); },\n      pop: () => { return pop(obj); },\n  }\n}\n\nfunction fromArray(arr) {\n  if (typeof(arr) !== \"object\") {\n    throw 'expected array as argument';\n  }\n  let set = {};\n  for (let i = 0; i < arr.length; ++i) {\n    if (typeof(arr[i]) === \"object\") {\n      throw 'cannot use objects as keys';\n    }\n    set[arr[i]] = true;\n  }\n  return augment(set);\n}\n\n// noninclusive upper bound;\nfunction fromRange(min, max) {\n  let set = {};\n  for (let i = 0; i < max; ++i) {\n    set[i] = true;\n  }\n  return augment(set);\n}\n\nfunction fromEmpty() {\n  return augment({});\n}\n\nexport default {fromArray, fromRange, fromEmpty};\n\n\n\n// WEBPACK FOOTER //\n// ./src/randomset.js"],"sourceRoot":""}